!function e(t,r,s){function n(c,i){if(!r[c]){if(!t[c]){var o="function"==typeof require&&require;if(!i&&o)return o(c,!0);if(a)return a(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[c]={exports:{}};t[c][0].call(d.exports,function(e){var r=t[c][1][e];return n(r?r:e)},d,d.exports,e,t,r,s)}return r[c].exports}for(var a="function"==typeof require&&require,c=0;c<s.length;c++)n(s[c]);return n}({1:[function(e,t,r){"use strict";var s=angular.module("cardsApp",["general.controllers","general.services","general.directives","general.filters","cardsApp.controllers","cardsApp.directives","ngRoute","ngSanitize"]);s.constant("CONFIG",window.CONFIG),delete window.CONFIG,s.config(["$routeProvider","$httpProvider","CONFIG",function(e,t,r){t.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.when("/card/list",{templateUrl:r.partialsUrl+"route/cardList.twig",controller:"cardsListCtrl"}).when("/card/edit/:id",{templateUrl:r.partialsUrl+"route/cardEdit.twig",controller:"cardEditCtrl"}).when("/card/view/:id",{templateUrl:r.partialsUrl+"route/cardView.twig",controller:"cardViewCtrl"}).when("/card/feedback",{templateUrl:r.partialsUrl+"route/cardFeedbackList.twig",controller:"cardFeedbackListCtrl"}).when("/card/feedback/:id",{templateUrl:r.partialsUrl+"route/cardFeedback.twig",controller:"cardFeedbackCtrl"}).otherwise({redirectTo:"/card/list"})}])},{}],2:[function(e,t,r){"use strict";e("./angular-app"),e("./controllers"),e("./directives"),e("../general/import")},{"../general/import":8,"./angular-app":1,"./controllers":3,"./directives":4}],3:[function(e,t,r){"use strict";var s=angular.module("cardsApp.controllers",[]);s.controller("cardsListCtrl",["$scope","$timeout","initialRouteSrv","cardsSrv","messageSrv","CONFIG",function(e,t,r,s,n,a){e.perPage=10,e.cards=null,e.total=0,e.currentPage=0,e.timeoutPromise=null,e.messages=n.collect(),r.checkStack()||(e.getPageOfStudentCardsInActivity=function(r){t.cancel(e.timeoutPromise),s.getPageOfStudentCardsInActivity(r,e.perPage,a.instanceid).then(function(t){e.cards=t.cards,e.total=t.total},function(t){e.cards=null,e.total=0,e.messages.error=t.errorMessage})["finally"](function(){e.timeoutPromise=t(function(){e.getPageOfStudentCardsInActivity(e.currentPage)},1e4)})},e.$watch("currentPage",function(t){e.getPageOfStudentCardsInActivity(t)}),e.$on("$destroy",function(){t.cancel(e.timeoutPromise)}))}]),s.controller("cardFeedbackListCtrl",["$scope","$timeout","cardsSrv","messageSrv","CONFIG",function(e,t,r,s,n){e.perPage=10,e.cards=null,e.total=0,e.currentPage=0,e.timeoutPromise=null,e.messages=s.collect(),e.getPageOfCardsInReviewInActivity=function(s){t.cancel(e.timeoutPromise),r.getPageOfCardsInReviewInActivity(s,e.perPage,n.instanceid).then(function(t){e.cards=t.cards,e.total=t.total},function(t){e.cards=null,e.total=0,e.messages.error=t.errorMessage})["finally"](function(){e.timeoutPromise=t(function(){e.getPageOfCardsInReviewInActivity(e.currentPage)},1e4)})},e.$watch("currentPage",function(t){e.getPageOfCardsInReviewInActivity(t)}),e.$on("$destroy",function(){t.cancel(e.timeoutPromise)})}])},{}],4:[function(e,t,r){"use strict";var s=angular.module("cardsApp.directives",[]);s.directive("cardListItem",["CONFIG",function(e){return{restrict:"A",scope:{card:"="},templateUrl:e.partialsUrl+"directive/cardListItem.twig",controller:["$scope",function(t){t.cardStatus=e.cardStatus,t.reverseCardStatus=e.reverseCardStatus,t.repositoryUrl=e.repositoryUrl,t.cardHref=function(t){var r=t.status===e.reverseCardStatus.in_review?"view":"edit";return"#/card/"+r+"/"+t.id}}]}}]),s.directive("cardFeedbackListItem",["CONFIG",function(e){return{restrict:"A",scope:{card:"="},templateUrl:e.partialsUrl+"directive/cardFeedbackListItem.twig",controller:["$scope",function(e){e.cardHref=function(e){return"#/card/feedback/"+e.id}}]}}]),s.directive("cardMenu",["$location","CONFIG",function(e,t){var r=["edit_cards","review_cards"],s=["/card/list","/card/feedback"];return{restrict:"E",scope:{},templateUrl:t.partialsUrl+"directive/cardMenu.twig",controller:["$scope",function(n){n.canFeedback=t.canFeedback;var a,c;for(n.menu=[],a=0,c=s.length;c>a;++a)n.menu.push({route:"#"+s[a],title:t.messages["menu_"+r[a]],active:e.path()===s[a]})}]}}])},{}],5:[function(e,t,r){"use strict";var s=angular.module("general.controllers",[]);s.controller("cardEditCtrl",["$scope","$routeParams","$timeout","$location","cardsSrv","messageSrv","CONFIG",function(e,t,r,s,n,a,c){e.app=c.app,e.card=null,e.messages=a.collect(),e.timeout=null,e.reverseCardStatus=c.reverseCardStatus,n.getCard(t.id).then(function(r){r.ownerid!==c.userid?(a.messages.warning=c.messages.cannot_edit_card_as_not_owner,s.path("/card/view/"+t.id)):r.status===c.reverseCardStatus.in_review?(a.messages.warning=c.messages.cannot_edit_card_as_in_review,s.path("/card/view/"+t.id)):e.card=r},function(t){e.messages.error=t.errorMessage,e.timeout=r(function(){s.path("/")},5e3)}),e.displayWord=function(){return n.displayWord(e.card)},e.saveChanges=function(){e.card.status===c.reverseCardStatus.not_started&&(e.card.status=c.reverseCardStatus.in_progress),n.putCard(e.card.id,e.card).then(function(t){var r=t.successMessage;delete t.successMessage,e.card=t,e.messages.success=r},function(t){e.messages.error=t.errorMessage})},e.sendToTutor=function(){e.card.status=c.reverseCardStatus.in_review,n.putCard(e.card.id,e.card).then(function(e){s.path("/card/view/"+e.id)},function(t){e.messages.error=t.errorMessage})},e.$on("$destroy",function(){r.cancel(e.timeout)})}]),s.controller("cardViewCtrl",["$scope","$routeParams","$timeout","$location","cardsSrv","messageSrv","CONFIG",function(e,t,r,s,n,a,c){e.app=c.app,e.card=null,e.messages=a.collect(),e.timeout=null,n.getCard(t.id).then(function(t){"repository"!==c.app||c.omniscience||t.status===c.reverseCardStatus.in_repository?e.card=t:(a.messages.warning=c.messages.cannot_view_card_as_not_in_repository,s.path("/"))},function(t){e.messages.error=t.errorMessage,e.timeout=r(function(){s.path("/")},5e3)}),e.displayWord=function(){return n.displayWord(e.card)},e.$on("$destroy",function(){r.cancel(e.timeout)})}]),s.controller("cardFeedbackCtrl",["$scope","$routeParams","$timeout","$window","$location","cardsSrv","feedbackSrv","messageSrv","CONFIG",function(e,t,r,s,n,a,c,i,o){e.app=o.app,e.card=null,e.messages=i.collect(),e.timeout=null,e.getCard=function(){a.getCard(t.id).then(function(r){"cards"===o.app&&r.status!==o.reverseCardStatus.in_review?(i.messages.warning=o.messages.cannot_review_card_as_not_in_review,n.path("/card/view/"+t.id)):"repository"===o.app&&r.status!==o.reverseCardStatus.in_repository?(i.messages.warning=o.messages.cannot_review_card_as_not_in_repository,n.path("/card/view/"+t.id)):"repository"===o.app&&r.ownerid===o.userid?(i.messages.warning=o.messages.cannot_review_own_card,n.path("/card/view/"+t.id)):e.card=r},function(t){e.messages.error=t.errorMessage,e.timeout=r(function(){n.path("/")},5e3)})},e.addFeedback=function(){var t=e.feedback;e.feedback="",c.postFeedback(t,e.card.id).then(function(t){e.messages.success=t.successMessage,e.getCard()},function(t){e.messages.error=t.errorMessage})},e.sendToStudent=function(){e.setCardStatusTo("in_progress")},e.sendToRepository=function(){e.setCardStatusTo("in_repository")},e.setCardStatusTo=function(t){e.card.status=o.reverseCardStatus[t],a.putCard(e.card.id,e.card).then(function(){n.path("/card/feedback")},function(t){e.messages.error=t.errorMessage})},e.editFeedback=function(t){c.putFeedback(t).then(function(t){e.messages.success=t.successMessage},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.getCard()})},e.deleteFeedback=function(t){r(function(){s.confirm(o.messages.confirm_delete_feedback)&&c.deleteFeedback(t).then(function(){e.messages.success=o.messages.feedback_deleted_successfully},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.getCard()})},1)},e.displayWord=function(){return a.displayWord(e.card)},e.$on("$destroy",function(){r.cancel(e.timeout)}),"cards"!==o.app||o.canFeedback?e.getCard():(i.messages.warning=o.messages.cannot_review,n.path("/"))}])},{}],6:[function(e,t,r){"use strict";var s=angular.module("general.directives",[]);s.directive("selectOnFocus",function(){return{restrict:"A",link:function(e,t){t.on("focus",function(){this.select()})}}}),s.directive("alerts",["CONFIG",function(e){return{restrict:"E",scope:{messages:"="},templateUrl:e.partialsUrl+"directive/alerts.twig",link:function(e,t){t.find("button").bind("click",function(){e.$apply(function(){e["class"]="",e.msg=""})})},controller:["$scope",function(e){e["class"]="",e.setMessage=function(t){e.messages[t]&&(e.msg=e.messages[t],e["class"]="alert-"+t,e.messages={})},angular.forEach(["success","error","warning","info"],function(t){e.$watch("messages."+t,function(){e.setMessage(t)},!0)})}]}}]),s.directive("pagination",["CONFIG",function(e){return{restrict:"E",scope:{perPage:"@",currentPage:"=",total:"=",fetchPage:"&"},templateUrl:e.partialsUrl+"directive/pagination.twig",controller:["$scope",function(e){e.currentPage=0,e.pageCount=0,e.pages=[],e.calculatePageCount=function(){e.pageCount=0===e.total?1:Math.ceil(e.total/e.perPage)},e.calculatePages=function(){var t,r,s;for(t=1,r=e.pageCount,e.pages=[],s=t;r>=s;++s)e.pages.push(s)},e.$watch("currentPage",function(){e.calculatePages()}),e.$watch("total",function(){e.calculatePageCount(),e.calculatePages()}),e.prevPage=function(){e.currentPage>0&&--e.currentPage},e.prevPageDisabled=function(){var t=0===e.currentPage?"disabled":"";return t},e.nextPage=function(){e.currentPage<e.pageCount-1&&e.currentPage++},e.nextPageDisabled=function(){var t=e.currentPage===e.pageCount-1?"disabled":"";return t},e.pageDisabled=function(t){var r=e.currentPage===t;return r},e.gotoPage=function(t){e.currentPage=t}}]}}]),s.directive("feedback",["$timeout","feedbackSrv","CONFIG",function(e,t,r){return{restrict:"E",scope:{card:"=",messages:"=",editF:"&",deleteF:"&"},templateUrl:r.partialsUrl+"directive/feedback.twig",controller:["$scope",function(r){r.perPage=5,r.feedback=null,r.total=0,r.currentPage=0,r.timeoutPromise=null,r.getPageOfFeedback=function(s){r.card&&(e.cancel(r.timeoutPromise),t.getPageOfFeedback(s,r.perPage,r.card.id).then(function(e){r.feedback=e.feedback,r.total=e.total},function(e){r.feedback=null,r.total=0,r.messages.error=e.errorMessage})["finally"](function(){r.timeoutPromise=e(function(){r.getPageOfFeedback(r.currentPage)},1e4)}))},r.$watch("currentPage",function(e){r.getPageOfFeedback(e)}),r.$watch("card",function(){r.currentPage=0,r.getPageOfFeedback(r.currentPage)},!0),r.editFeedback=function(e){r.editF({feedback:e})},r.deleteFeedback=function(e){r.deleteF({feedbackid:e})},r.stopAutoRefresh=function(){e.cancel(r.timeoutPromise)},r.startAutoRefresh=function(){r.getPageOfFeedback(r.currentPage)},r.$on("$destroy",function(){e.cancel(r.timeoutPromise)})}]}}]),s.directive("feedbackListItem",["$timeout","CONFIG",function(e,t){return{restrict:"A",scope:{feedback:"=",editFeedback:"&",deleteFeedback:"&",stopAutoRefresh:"&",startAutoRefresh:"&"},templateUrl:t.partialsUrl+"directive/feedbackListItem.twig",controller:["$scope",function(r){r.userid=t.userid,r.editing=!1,r.canFeedback=t.canFeedback,r.enableEditing=function(){r.editing=!0,r.stopAutoRefresh(),r.oldFeedback=r.feedback.feedback,e(function(){r.elem.focus()},1)},r.disableEditing=function(){r.oldFeedback!==r.feedback.feedback?r.editFeedback({feedback:r.feedback}):r.startAutoRefresh()}}],link:function(e,t){e.elem=t.find("input")[0],t.bind("keyup",function(t){!e.editing||13!==t.which&&27!==t.which||e.$apply(function(){e.editing=!1,13===t.which?e.disableEditing():27===t.which&&(e.feedback.feedback=e.oldFeedback,e.startAutoRefresh())})})}}}])},{}],7:[function(e,t,r){"use strict";var s=angular.module("general.filters",[]);s.filter("substring",function(){return function(e,t,r){return e.substring(t,r)}}),s.filter("pipes",["$sce",function(e){return function(t){return t?e.trustAsHtml(t.replace(/\s*,\s*/g,"&nbsp;<strong>|</strong>&nbsp;")):""}}])},{}],8:[function(e,t,r){"use strict";e("./controllers"),e("./directives"),e("./services"),e("./filters")},{"./controllers":5,"./directives":6,"./filters":7,"./services":9}],9:[function(e,t,r){"use strict";var s=angular.module("general.services",[]);s.service("wordsSrv",["$http","$q","CONFIG",function(e,t,r){var s=r.apiUrls.words;this.getPageOfWords=function(r,n,a,c){var i=t.defer();return e.get(s+"?limitfrom="+r*n+"&limitnum="+n+"&sectionid="+a+"&q="+encodeURIComponent(c)).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.getWord=function(r){var n=t.defer();return e.get(s+"/"+r).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.postWord=function(n,a){var c=t.defer(),i={word:n,sectionid:a};return e.post(s+"?sesskey="+r.sesskey,i).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.putWord=function(n,a,c){var i=t.defer(),o={word:a,sectionid:c};return e.put(s+"/"+n+"?sesskey="+r.sesskey,o).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.deleteWord=function(n){var a=t.defer();return e["delete"](s+"/"+n+"?sesskey="+r.sesskey).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}}]),s.service("studentsSrv",["$http","$q","CONFIG",function(e,t,r){var s=r.apiUrls.students;this.getPageOfStudents=function(r,n,a){var c=t.defer();return e.get(s+"?limitfrom="+r*n+"&limitnum="+n+"&groupid="+a).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise}}]),s.service("cardsSrv",["$http","$q","CONFIG",function(e,t,r){var s=r.apiUrls.cards;this.getPageOfStudentCardsInActivity=function(r,n,a){var c=t.defer();return e.get(s+"?limitfrom="+r*n+"&limitnum="+n+"&instanceid="+a).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.getPageOfCardsInReviewInActivity=function(r,n,a){var c=t.defer();return e.get(s+"/review?limitfrom="+r*n+"&limitnum="+n+"&instanceid="+a).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.getPageOfCardsInRepositoryInCourse=function(r,n,a){var c=t.defer();return e.get(s+"/repository?limitfrom="+r*n+"&limitnum="+n+"&groupid="+a.groupid+"&userid="+a.userid+"&q="+encodeURIComponent(a.q)+"&status="+a.status+"&sort="+encodeURIComponent(a.sort)).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.getCard=function(r){var n=t.defer();return e.get(s+"/"+r).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.putCard=function(n,a){var c=t.defer();return e.put(s+"/"+n+"?sesskey="+r.sesskey,a).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.createCardsFromWords=function(n,a,c){var i=t.defer(),o=[],u={};return angular.forEach(n,function(e){o.push(e.id)}),u.wordids=o,u.ownerid=a.id,u.groupid=c,e.post(s+"/create?sesskey="+r.sesskey,u).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.deleteCard=function(n){var a=t.defer();return e["delete"](s+"/"+n+"?sesskey="+r.sesskey).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.displayWord=function(e){return e?e.word.charAt(0).toUpperCase()+e.word.slice(1):""}}]),s.service("feedbackSrv",["$http","$q","CONFIG",function(e,t,r){var s=r.apiUrls.feedbacks;this.getPageOfFeedback=function(r,n,a){var c=t.defer();return e.get(s+"?limitfrom="+r*n+"&limitnum="+n+"&cardid="+a).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.postFeedback=function(n,a){var c=t.defer(),i={feedback:n,cardid:a},o=r.hasOwnProperty("cmid")?"&cmid="+r.cmid:"";return e.post(s+"?sesskey="+r.sesskey+"&app="+r.app+o,i).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.putFeedback=function(n){var a=t.defer(),c={feedback:n.feedback};return e.put(s+"/"+n.id+"?sesskey="+r.sesskey+"&app="+r.app,c).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.deleteFeedback=function(n){var a=t.defer();return e["delete"](s+"/"+n+"?sesskey="+r.sesskey+"&app="+r.app).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}}]),s.service("repoFilterSrv",["CONFIG",function(e){this.filters={groupid:0,userid:0,q:"",status:e.reverseCardStatus.in_repository,sort:"word"}}]),s.service("initialRouteSrv",["$location","CONFIG",function(e,t){var r=[];t.angularjs_route&&r.push(t.angularjs_route),this.checkStack=function(){var t=null;return r.length&&(t=r.pop(),e.path(t)),t}}]),s.service("messageSrv",function(){this.messages={},this.collect=function(){var e={};return angular.copy(this.messages,e),this.messages={},e}})},{}]},{},[2]);