!function e(r,t,s){function n(a,c){if(!t[a]){if(!r[a]){var o="function"==typeof require&&require;if(!c&&o)return o(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=t[a]={exports:{}};r[a][0].call(d.exports,function(e){var t=r[a][1][e];return n(t?t:e)},d,d.exports,e,r,t,s)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<s.length;a++)n(s[a]);return n}({1:[function(e,r,t){"use strict";var s=angular.module("general.controllers",[]);s.controller("cardEditCtrl",["$scope","$routeParams","$timeout","$location","cardsSrv","messageSrv","CONFIG",function(e,r,t,s,n,i,a){e.app=a.app,e.card=null,e.messages=i.collect(),e.timeout=null,e.reverseCardStatus=a.reverseCardStatus,n.getCard(r.id).then(function(t){t.ownerid!==a.userid?(i.messages.warning=a.messages.cannot_edit_card_as_not_owner,s.path("/card/view/"+r.id)):t.status===a.reverseCardStatus.in_review?(i.messages.warning=a.messages.cannot_edit_card_as_in_review,s.path("/card/view/"+r.id)):e.card=t},function(r){e.messages.error=r.errorMessage,e.timeout=t(function(){s.path("/")},5e3)}),e.displayWord=function(){return n.displayWord(e.card)},e.saveChanges=function(){e.card.status===a.reverseCardStatus.not_started&&(e.card.status=a.reverseCardStatus.in_progress),n.putCard(e.card.id,e.card).then(function(r){var t=r.successMessage;delete r.successMessage,e.card=r,e.messages.success=t},function(r){e.messages.error=r.errorMessage})},e.sendToTutor=function(){e.card.status=a.reverseCardStatus.in_review,n.putCard(e.card.id,e.card).then(function(e){s.path("/card/view/"+e.id)},function(r){e.messages.error=r.errorMessage})},e.$on("$destroy",function(){t.cancel(e.timeout)})}]),s.controller("cardViewCtrl",["$scope","$routeParams","$timeout","$location","cardsSrv","messageSrv","CONFIG",function(e,r,t,s,n,i,a){e.app=a.app,e.card=null,e.messages=i.collect(),e.timeout=null,n.getCard(r.id).then(function(r){"repository"!==a.app||a.omniscience||r.status===a.reverseCardStatus.in_repository?e.card=r:(i.messages.warning=a.messages.cannot_view_card_as_not_in_repository,s.path("/"))},function(r){e.messages.error=r.errorMessage,e.timeout=t(function(){s.path("/")},5e3)}),e.displayWord=function(){return n.displayWord(e.card)},e.$on("$destroy",function(){t.cancel(e.timeout)})}]),s.controller("cardFeedbackCtrl",["$scope","$routeParams","$timeout","$window","$location","cardsSrv","feedbackSrv","messageSrv","CONFIG",function(e,r,t,s,n,i,a,c,o){e.app=o.app,e.card=null,e.messages=c.collect(),e.timeout=null,e.getCard=function(){i.getCard(r.id).then(function(t){"cards"===o.app&&t.status!==o.reverseCardStatus.in_review?(c.messages.warning=o.messages.cannot_review_card_as_not_in_review,n.path("/card/view/"+r.id)):"repository"===o.app&&t.status!==o.reverseCardStatus.in_repository?(c.messages.warning=o.messages.cannot_review_card_as_not_in_repository,n.path("/card/view/"+r.id)):"repository"===o.app&&t.ownerid===o.userid?(c.messages.warning=o.messages.cannot_review_own_card,n.path("/card/view/"+r.id)):e.card=t},function(r){e.messages.error=r.errorMessage,e.timeout=t(function(){n.path("/")},5e3)})},e.addFeedback=function(){var r=e.feedback;e.feedback="",a.postFeedback(r,e.card.id).then(function(r){e.messages.success=r.successMessage,e.getCard()},function(r){e.messages.error=r.errorMessage})},e.sendToStudent=function(){e.setCardStatusTo("in_progress")},e.sendToRepository=function(){e.setCardStatusTo("in_repository")},e.setCardStatusTo=function(r){e.card.status=o.reverseCardStatus[r],i.putCard(e.card.id,e.card).then(function(){n.path("/card/feedback")},function(r){e.messages.error=r.errorMessage})},e.editFeedback=function(r){a.putFeedback(r).then(function(r){e.messages.success=r.successMessage},function(r){e.messages.error=r.errorMessage})["finally"](function(){e.getCard()})},e.deleteFeedback=function(r){t(function(){s.confirm(o.messages.confirm_delete_feedback)&&a.deleteFeedback(r).then(function(){e.messages.success=o.messages.feedback_deleted_successfully},function(r){e.messages.error=r.errorMessage})["finally"](function(){e.getCard()})},1)},e.displayWord=function(){return i.displayWord(e.card)},e.$on("$destroy",function(){t.cancel(e.timeout)}),"cards"!==o.app||o.canFeedback?e.getCard():(c.messages.warning=o.messages.cannot_review,n.path("/"))}])},{}],2:[function(e,r,t){"use strict";var s=angular.module("general.directives",[]);s.directive("selectOnFocus",function(){return{restrict:"A",link:function(e,r){r.on("focus",function(){this.select()})}}}),s.directive("alerts",["CONFIG",function(e){return{restrict:"E",scope:{messages:"="},templateUrl:e.partialsUrl+"directive/alerts.twig",link:function(e,r){r.find("button").bind("click",function(){e.$apply(function(){e["class"]="",e.msg=""})})},controller:["$scope",function(e){e["class"]="",e.setMessage=function(r){e.messages[r]&&(e.msg=e.messages[r],e["class"]="alert-"+r,e.messages={})},angular.forEach(["success","error","warning","info"],function(r){e.$watch("messages."+r,function(){e.setMessage(r)},!0)})}]}}]),s.directive("pagination",["CONFIG",function(e){return{restrict:"E",scope:{perPage:"@",currentPage:"=",total:"=",fetchPage:"&"},templateUrl:e.partialsUrl+"directive/pagination.twig",controller:["$scope",function(e){e.currentPage=0,e.pageCount=0,e.pages=[],e.calculatePageCount=function(){0===e.total?e.pageCount=1:e.pageCount=Math.ceil(e.total/e.perPage)},e.calculatePages=function(){var r,t,s;for(r=1,t=e.pageCount,e.pages=[],s=r;t>=s;++s)e.pages.push(s)},e.$watch("currentPage",function(){e.calculatePages()}),e.$watch("total",function(){e.calculatePageCount(),e.calculatePages()}),e.prevPage=function(){e.currentPage>0&&--e.currentPage},e.prevPageDisabled=function(){var r=0===e.currentPage?"disabled":"";return r},e.nextPage=function(){e.currentPage<e.pageCount-1&&e.currentPage++},e.nextPageDisabled=function(){var r=e.currentPage===e.pageCount-1?"disabled":"";return r},e.pageDisabled=function(r){var t=e.currentPage===r;return t},e.gotoPage=function(r){e.currentPage=r}}]}}]),s.directive("feedback",["$timeout","feedbackSrv","CONFIG",function(e,r,t){return{restrict:"E",scope:{card:"=",messages:"=",editF:"&",deleteF:"&"},templateUrl:t.partialsUrl+"directive/feedback.twig",controller:["$scope",function(t){t.perPage=5,t.feedback=null,t.total=0,t.currentPage=0,t.timeoutPromise=null,t.getPageOfFeedback=function(s){t.card&&(e.cancel(t.timeoutPromise),r.getPageOfFeedback(s,t.perPage,t.card.id).then(function(e){t.feedback=e.feedback,t.total=e.total},function(e){t.feedback=null,t.total=0,t.messages.error=e.errorMessage})["finally"](function(){t.timeoutPromise=e(function(){t.getPageOfFeedback(t.currentPage)},1e4)}))},t.$watch("currentPage",function(e){t.getPageOfFeedback(e)}),t.$watch("card",function(){t.currentPage=0,t.getPageOfFeedback(t.currentPage)},!0),t.editFeedback=function(e){t.editF({feedback:e})},t.deleteFeedback=function(e){t.deleteF({feedbackid:e})},t.stopAutoRefresh=function(){e.cancel(t.timeoutPromise)},t.startAutoRefresh=function(){t.getPageOfFeedback(t.currentPage)},t.$on("$destroy",function(){e.cancel(t.timeoutPromise)})}]}}]),s.directive("feedbackListItem",["$timeout","CONFIG",function(e,r){return{restrict:"A",scope:{feedback:"=",editFeedback:"&",deleteFeedback:"&",stopAutoRefresh:"&",startAutoRefresh:"&"},templateUrl:r.partialsUrl+"directive/feedbackListItem.twig",controller:["$scope",function(t){t.userid=r.userid,t.editing=!1,t.canFeedback=r.canFeedback,t.enableEditing=function(){t.editing=!0,t.stopAutoRefresh(),t.oldFeedback=t.feedback.feedback,e(function(){t.elem.focus()},1)},t.disableEditing=function(){t.oldFeedback!==t.feedback.feedback?t.editFeedback({feedback:t.feedback}):t.startAutoRefresh()}}],link:function(e,r){e.elem=r.find("input")[0],r.bind("keyup",function(r){!e.editing||13!==r.which&&27!==r.which||e.$apply(function(){e.editing=!1,13===r.which?e.disableEditing():27===r.which&&(e.feedback.feedback=e.oldFeedback,e.startAutoRefresh())})})}}}])},{}],3:[function(e,r,t){"use strict";var s=angular.module("general.filters",[]);s.filter("substring",function(){return function(e,r,t){return e.substring(r,t)}}),s.filter("pipes",["$sce",function(e){return function(r){return r?e.trustAsHtml(r.replace(/\s*,\s*/g,"&nbsp;<strong>|</strong>&nbsp;")):""}}])},{}],4:[function(e,r,t){"use strict";e("./controllers"),e("./directives"),e("./services"),e("./filters")},{"./controllers":1,"./directives":2,"./filters":3,"./services":5}],5:[function(e,r,t){"use strict";var s=angular.module("general.services",[]);s.service("wordsSrv",["$http","$q","CONFIG",function(e,r,t){var s=t.apiUrls.words;this.getPageOfWords=function(t,n,i,a){var c=r.defer();return e.get(s+"?limitfrom="+t*n+"&limitnum="+n+"&sectionid="+i+"&q="+encodeURIComponent(a)).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.getWord=function(t){var n=r.defer();return e.get(s+"/"+t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.postWord=function(n,i){var a=r.defer(),c={word:n,sectionid:i};return e.post(s+"?sesskey="+t.sesskey,c).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.putWord=function(n,i,a){var c=r.defer(),o={word:i,sectionid:a};return e.put(s+"/"+n+"?sesskey="+t.sesskey,o).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.deleteWord=function(n){var i=r.defer();return e["delete"](s+"/"+n+"?sesskey="+t.sesskey).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}]),s.service("studentsSrv",["$http","$q","CONFIG",function(e,r,t){var s=t.apiUrls.students;this.getPageOfStudents=function(t,n,i){var a=r.defer();return e.get(s+"?limitfrom="+t*n+"&limitnum="+n+"&groupid="+i).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}}]),s.service("cardsSrv",["$http","$q","CONFIG",function(e,r,t){var s=t.apiUrls.cards;this.getPageOfStudentCardsInActivity=function(t,n,i){var a=r.defer();return e.get(s+"?limitfrom="+t*n+"&limitnum="+n+"&instanceid="+i).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.getPageOfCardsInReviewInActivity=function(t,n,i){var a=r.defer();return e.get(s+"/review?limitfrom="+t*n+"&limitnum="+n+"&instanceid="+i).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.getPageOfCardsInRepositoryInCourse=function(t,n,i){var a=r.defer();return e.get(s+"/repository?limitfrom="+t*n+"&limitnum="+n+"&groupid="+i.groupid+"&userid="+i.userid+"&q="+encodeURIComponent(i.q)+"&status="+i.status+"&sort="+encodeURIComponent(i.sort)).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.getCard=function(t){var n=r.defer();return e.get(s+"/"+t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.putCard=function(n,i){var a=r.defer();return e.put(s+"/"+n+"?sesskey="+t.sesskey,i).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.createCardsFromWords=function(n,i,a){var c=r.defer(),o=[],u={};return angular.forEach(n,function(e){o.push(e.id)}),u.wordids=o,u.ownerid=i.id,u.groupid=a,e.post(s+"/create?sesskey="+t.sesskey,u).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.deleteCard=function(n){var i=r.defer();return e["delete"](s+"/"+n+"?sesskey="+t.sesskey).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.displayWord=function(e){return e?e.word.charAt(0).toUpperCase()+e.word.slice(1):""}}]),s.service("feedbackSrv",["$http","$q","CONFIG",function(e,r,t){var s=t.apiUrls.feedbacks;this.getPageOfFeedback=function(t,n,i){var a=r.defer();return e.get(s+"?limitfrom="+t*n+"&limitnum="+n+"&cardid="+i).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.postFeedback=function(n,i){var a=r.defer(),c={feedback:n,cardid:i},o=t.hasOwnProperty("cmid")?"&cmid="+t.cmid:"";return e.post(s+"?sesskey="+t.sesskey+"&app="+t.app+o,c).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.putFeedback=function(n){var i=r.defer(),a={feedback:n.feedback};return e.put(s+"/"+n.id+"?sesskey="+t.sesskey+"&app="+t.app,a).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.deleteFeedback=function(n){var i=r.defer();return e["delete"](s+"/"+n+"?sesskey="+t.sesskey+"&app="+t.app).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}]),s.service("repoFilterSrv",["CONFIG",function(e){this.filters={groupid:0,userid:0,q:"",status:e.reverseCardStatus.in_repository,sort:"word"}}]),s.service("initialRouteSrv",["$location","CONFIG",function(e,r){var t=[];r.angularjs_route&&t.push(r.angularjs_route),this.checkStack=function(){var r=null;return t.length&&(r=t.pop(),e.path(r)),r}}]),s.service("messageSrv",function(){this.messages={},this.collect=function(){var e={};return angular.copy(this.messages,e),this.messages={},e}})},{}],6:[function(e,r,t){"use strict";var s=angular.module("repositoryApp",["general.controllers","general.services","general.directives","general.filters","repositoryApp.controllers","repositoryApp.directives","ngRoute","ngSanitize"]);s.constant("CONFIG",window.CONFIG),delete window.CONFIG,s.config(["$routeProvider","$httpProvider","CONFIG",function(e,r,t){r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.when("/",{templateUrl:t.partialsUrl+"route/repository.twig",controller:"repositoryCtrl"}).when("/card/edit/:id",{templateUrl:t.partialsUrl+"route/cardEdit.twig",controller:"cardEditCtrl"}).when("/card/view/:id",{templateUrl:t.partialsUrl+"route/cardView.twig",controller:"cardViewCtrl"}).when("/card/feedback/:id",{templateUrl:t.partialsUrl+"route/cardFeedback.twig",controller:"cardFeedbackCtrl"}).otherwise({redirectTo:"/"})}])},{}],7:[function(e,r,t){"use strict";e("./angular-app"),e("./controllers"),e("./directives"),e("../general/import")},{"../general/import":4,"./angular-app":6,"./controllers":8,"./directives":9}],8:[function(e,r,t){"use strict";var s=angular.module("repositoryApp.controllers",[]);s.controller("repositoryCtrl",["$scope","$timeout","initialRouteSrv","cardsSrv","repoFilterSrv","messageSrv","CONFIG",function(e,r,t,s,n,i,a){e.cards=null,e.total=0,e.perPage=10,e.currentPage=0,e.timeoutPromise=null,e.messages=i.collect(),e.userid=a.userid,e.groups=a.groups,e.omniscience=a.omniscience,e.cardStatus=a.cardStatus,e.filters=n.filters,e.prevFilterQ=n.filters.q,e.exportUrl=a.exportUrl,t.checkStack()||(e.omniscience&&(e.messages.info=a.messages.omniscience),e.getPageOfCards=function(t){r.cancel(e.timeoutPromise),s.getPageOfCardsInRepositoryInCourse(t,e.perPage,e.filters).then(function(r){e.cards=r.cards,e.total=r.total},function(r){e.cards=null,e.total=0,e.messages.error=r.errorMessage})["finally"](function(){e.timeoutPromise=r(function(){e.getPageOfCards(e.currentPage)},1e4)})},e.$watch("currentPage",function(r){e.getPageOfCards(r)}),e.filterChanged=function(){e.currentPage=0,e.getPageOfCards(e.currentPage)},e.sortChanged=function(){e.getPageOfCards(e.currentPage)},e.filterQChanged=function(){r.cancel(e.timeoutPromise),e.timeoutPromise=r(function(){e.prevFilterQ!==e.filters.q?(e.prevFilterQ=e.filters.q,e.filterChanged()):e.timeoutPromise=r(function(){e.getPageOfCards(e.currentPage)},1e4)},1e3)},e.$on("$destroy",function(){r.cancel(e.timeoutPromise)}))}])},{}],9:[function(e,r,t){"use strict";var s=angular.module("repositoryApp.directives",[]);s.directive("repoListItem",["cardsSrv","CONFIG",function(e,r){return{restrict:"A",scope:{card:"=",messages:"=",filterChanged:"&"},templateUrl:r.partialsUrl+"directive/repoListItem.twig",controller:["$scope",function(t){t.cardStatus=r.cardStatus,t.omniscience=r.omniscience,t.cardHref=function(e){var t="view";return e.ownerid===r.userid&&e.status!==r.reverseCardStatus.in_review?t="edit":e.status===r.reverseCardStatus.in_repository&&(t="feedback"),"#/card/"+t+"/"+e.id},t.statusChanged=function(r){e.putCard(r.id,r).then(function(e){var r=e.successMessage;delete e.successMessage,t.card=e,t.messages.success=r,t.filterChanged()},function(e){t.messages.error=e.errorMessage})}}]}}])},{}]},{},[7]);