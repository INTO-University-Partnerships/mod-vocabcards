!function e(t,r,s){function n(i,c){if(!r[i]){if(!t[i]){var a="function"==typeof require&&require;if(!c&&a)return a(i,!0);if(o)return o(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[i]={exports:{}};t[i][0].call(d.exports,function(e){var r=t[i][1][e];return n(r?r:e)},d,d.exports,e,t,r,s)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<s.length;i++)n(s[i]);return n}({1:[function(e,t,r){"use strict";var s=angular.module("assignmentApp",["general.controllers","general.services","general.directives","general.filters","assignmentApp.controllers","assignmentApp.directives","ngRoute","ngSanitize"]);s.constant("CONFIG",window.CONFIG),delete window.CONFIG,s.config(["$routeProvider","$httpProvider","CONFIG",function(e,t,r){t.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.when("/",{templateUrl:r.partialsUrl+"route/assignment.twig",controller:"assignmentCtrl"}).otherwise({redirectTo:"/"})}])},{}],2:[function(e,t,r){"use strict";e("./angular-app"),e("./controllers"),e("./directives"),e("../general/import")},{"../general/import":8,"./angular-app":1,"./controllers":3,"./directives":4}],3:[function(e,t,r){"use strict";var s=angular.module("assignmentApp.controllers",[]);s.controller("assignmentCtrl",["$scope",function(e){e.unavailableWords={ids:[]},e.timers={on:!0},e.messages={},e.selections={words:[],student:null,filterGroup:0},e.getIndexOfWordId=function(t){var r=-1;return angular.forEach(e.selections.words,function(e,s){return e.id===t?(r=s,!1):void 0}),r},e.getIndexOfWord=function(t){return e.getIndexOfWordId(t.id)},e.setSelectedStudentWords=function(){e.unavailableWords.ids=[],e.selections.student&&0!==e.selections.student.cards.length&&angular.forEach(e.selections.student.cards,function(t){var r;e.unavailableWords.ids.push(t.wordid),r=e.getIndexOfWordId(t.wordid),-1!==r&&e.selections.words.splice(r,1)})},e.$watch("selections.student",function(){e.setSelectedStudentWords()}),e.getIndexOfUnavailableWordId=function(t){var r=-1;return angular.forEach(e.unavailableWords.ids,function(e,s){return e===t?(r=s,!1):void 0}),r}}]),s.controller("wordsCtrl",["$scope","$timeout","wordsSrv","CONFIG",function(e,t,r,s){e.perPageWords=12,e.words=null,e.totalWords=0,e.currentPageWords=0,e.timeoutPromiseWords=null,e.sections=s.sections,e.filterSection=0,e.filterQ=e.prevFilterQ="",e.getPageOfWords=function(s){t.cancel(e.timeoutPromiseWords),r.getPageOfWords(s,e.perPageWords,e.filterSection,e.filterQ).then(function(t){e.words=t.words,e.totalWords=t.total},function(t){e.words=null,e.totalWords=0,e.messages.error=t.errorMessage})["finally"](function(){e.timeoutPromiseWords=t(function(){e.getPageOfWords(e.currentPageWords)},1e4)})},e.$watch("currentPageWords",function(t){e.getPageOfWords(t)}),e.$watch("timers.on",function(r,s){r===!0&&s===!1?e.getPageOfWords(e.currentPageWords):r===!1&&s===!0&&t.cancel(e.timeoutPromiseWords)}),e.filterSectionChanged=function(){e.currentPageWords=0,e.getPageOfWords(0)},e.filterQChanged=function(){t.cancel(e.timeoutPromiseWords),e.timeoutPromiseWords=t(function(){e.prevFilterQ!==e.filterQ?(e.prevFilterQ=e.filterQ,e.currentPageWords=0,e.getPageOfWords(0)):e.timeoutPromiseWords=t(function(){e.getPageOfWords(e.currentPageWords)},1e4)},1e3)},e.toggleSelectedWord=function(t){e.$apply(function(){var r=e.getIndexOfUnavailableWordId(t.id);-1===r&&(r=e.getIndexOfWord(t),-1===r?e.selections.words.push(t):e.selections.words.splice(r,1))})},e.$on("$destroy",function(){t.cancel(e.timeoutPromiseWords)})}]),s.controller("studentsCtrl",["$scope","$timeout","$window","studentsSrv","cardsSrv","CONFIG",function(e,t,r,s,n,o){e.perPageStudents=8,e.students=null,e.totalStudents=0,e.currentPageStudents=0,e.timeoutPromiseStudents=null,e.groups=o.groups,e.getPageOfStudents=function(r){t.cancel(e.timeoutPromiseStudents),s.getPageOfStudents(r,e.perPageStudents,e.selections.filterGroup).then(function(t){e.students=t.students,e.totalStudents=t.total},function(t){e.students=null,e.totalStudents=0,e.messages.error=t.errorMessage})["finally"](function(){e.selections.student&&angular.forEach(e.students,function(t){t.id===e.selections.student.id&&(e.selections.student.cards=t.cards)}),e.setSelectedStudentWords(),e.timeoutPromiseStudents=t(function(){e.getPageOfStudents(e.currentPageStudents)},1e4)})},e.$watch("currentPageStudents",function(t){e.getPageOfStudents(t)}),e.$watch("timers.on",function(r,s){r===!0&&s===!1?e.getPageOfStudents(e.currentPageStudents):r===!1&&s===!0&&t.cancel(e.timeoutPromiseStudents)}),e.filterGroupChanged=function(){e.selections.student=null,e.currentPageStudents=0,e.getPageOfStudents(0)},e.setSelectedStudent=function(t){e.$apply(function(){e.selections.student&&e.selections.student.id===t.id?e.selections.student=null:e.selections.student=t})},e.deleteCard=function(s){e.timers.on=!1,t(function(){return r.confirm(o.messages.confirm_delete_card)?void n.deleteCard(s).then(function(){e.messages.success=o.messages.card_deleted_successfully},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.timers.on=!0}):void(e.timers.on=!0)},1)},e.$on("$destroy",function(){t.cancel(e.timeoutPromiseStudents)})}]),s.controller("confirmationCtrl",["$scope","$timeout","$window","cardsSrv","CONFIG",function(e,t,r,s,n){e.createCardsFromWords=function(){var o=e.selections.words,i=e.selections.student;e.timers.on=!1,t(function(){return 0!==e.selections.filterGroup||r.confirm(n.messages.confirm_assign_cards_without_group)?(e.selections.words=[],e.selections.student=null,void s.createCardsFromWords(o,i,e.selections.filterGroup).then(function(t){e.messages.success=t.successMessage},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.timers.on=!0})):void(e.timers.on=!0)},1)},e.removeWord=function(t){var r=e.getIndexOfWord(t);-1!==r&&e.selections.words.splice(r,1)},e.removeStudent=function(){e.selections.student=null}}])},{}],4:[function(e,t,r){"use strict";var s=angular.module("assignmentApp.directives",[]);s.directive("wordListItemShort",["CONFIG",function(e){return{restrict:"A",scope:{word:"=",toggleSelectedWord:"&"},templateUrl:e.partialsUrl+"directive/wordListItemShort.twig",link:function(e,t){t.bind("click",function(){e.toggleSelectedWord({word:e.word})})}}}]),s.directive("studentListItem",["CONFIG",function(e){return{restrict:"A",scope:{student:"=",setSelectedStudent:"&",deleteCard:"&"},templateUrl:e.partialsUrl+"directive/studentListItem.twig",link:function(e,t){t.bind("click",function(){e.setSelectedStudent({student:e.student})})}}}])},{}],5:[function(e,t,r){"use strict";var s=angular.module("general.controllers",[]);s.controller("cardEditCtrl",["$scope","$routeParams","$timeout","$location","cardsSrv","messageSrv","CONFIG",function(e,t,r,s,n,o,i){e.app=i.app,e.card=null,e.messages=o.collect(),e.timeout=null,e.reverseCardStatus=i.reverseCardStatus,n.getCard(t.id).then(function(r){r.ownerid!==i.userid?(o.messages.warning=i.messages.cannot_edit_card_as_not_owner,s.path("/card/view/"+t.id)):r.status===i.reverseCardStatus.in_review?(o.messages.warning=i.messages.cannot_edit_card_as_in_review,s.path("/card/view/"+t.id)):e.card=r},function(t){e.messages.error=t.errorMessage,e.timeout=r(function(){s.path("/")},5e3)}),e.displayWord=function(){return n.displayWord(e.card)},e.saveChanges=function(){e.card.status===i.reverseCardStatus.not_started&&(e.card.status=i.reverseCardStatus.in_progress),n.putCard(e.card.id,e.card).then(function(t){var r=t.successMessage;delete t.successMessage,e.card=t,e.messages.success=r},function(t){e.messages.error=t.errorMessage})},e.sendToTutor=function(){e.card.status=i.reverseCardStatus.in_review,n.putCard(e.card.id,e.card).then(function(e){s.path("/card/view/"+e.id)},function(t){e.messages.error=t.errorMessage})},e.$on("$destroy",function(){r.cancel(e.timeout)})}]),s.controller("cardViewCtrl",["$scope","$routeParams","$timeout","$location","cardsSrv","messageSrv","CONFIG",function(e,t,r,s,n,o,i){e.app=i.app,e.card=null,e.messages=o.collect(),e.timeout=null,n.getCard(t.id).then(function(t){"repository"!==i.app||i.omniscience||t.status===i.reverseCardStatus.in_repository?e.card=t:(o.messages.warning=i.messages.cannot_view_card_as_not_in_repository,s.path("/"))},function(t){e.messages.error=t.errorMessage,e.timeout=r(function(){s.path("/")},5e3)}),e.displayWord=function(){return n.displayWord(e.card)},e.$on("$destroy",function(){r.cancel(e.timeout)})}]),s.controller("cardFeedbackCtrl",["$scope","$routeParams","$timeout","$window","$location","cardsSrv","feedbackSrv","messageSrv","CONFIG",function(e,t,r,s,n,o,i,c,a){e.app=a.app,e.card=null,e.messages=c.collect(),e.timeout=null,e.getCard=function(){o.getCard(t.id).then(function(r){"cards"===a.app&&r.status!==a.reverseCardStatus.in_review?(c.messages.warning=a.messages.cannot_review_card_as_not_in_review,n.path("/card/view/"+t.id)):"repository"===a.app&&r.status!==a.reverseCardStatus.in_repository?(c.messages.warning=a.messages.cannot_review_card_as_not_in_repository,n.path("/card/view/"+t.id)):"repository"===a.app&&r.ownerid===a.userid?(c.messages.warning=a.messages.cannot_review_own_card,n.path("/card/view/"+t.id)):e.card=r},function(t){e.messages.error=t.errorMessage,e.timeout=r(function(){n.path("/")},5e3)})},e.addFeedback=function(){var t=e.feedback;e.feedback="",i.postFeedback(t,e.card.id).then(function(t){e.messages.success=t.successMessage,e.getCard()},function(t){e.messages.error=t.errorMessage})},e.sendToStudent=function(){e.setCardStatusTo("in_progress")},e.sendToRepository=function(){e.setCardStatusTo("in_repository")},e.setCardStatusTo=function(t){e.card.status=a.reverseCardStatus[t],o.putCard(e.card.id,e.card).then(function(){n.path("/card/feedback")},function(t){e.messages.error=t.errorMessage})},e.editFeedback=function(t){i.putFeedback(t).then(function(t){e.messages.success=t.successMessage},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.getCard()})},e.deleteFeedback=function(t){r(function(){s.confirm(a.messages.confirm_delete_feedback)&&i.deleteFeedback(t).then(function(){e.messages.success=a.messages.feedback_deleted_successfully},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.getCard()})},1)},e.displayWord=function(){return o.displayWord(e.card)},e.$on("$destroy",function(){r.cancel(e.timeout)}),"cards"!==a.app||a.canFeedback?e.getCard():(c.messages.warning=a.messages.cannot_review,n.path("/"))}])},{}],6:[function(e,t,r){"use strict";var s=angular.module("general.directives",[]);s.directive("selectOnFocus",function(){return{restrict:"A",link:function(e,t){t.on("focus",function(){this.select()})}}}),s.directive("alerts",["CONFIG",function(e){return{restrict:"E",scope:{messages:"="},templateUrl:e.partialsUrl+"directive/alerts.twig",link:function(e,t){t.find("button").bind("click",function(){e.$apply(function(){e["class"]="",e.msg=""})})},controller:["$scope",function(e){e["class"]="",e.setMessage=function(t){e.messages[t]&&(e.msg=e.messages[t],e["class"]="alert-"+t,e.messages={})},angular.forEach(["success","error","warning","info"],function(t){e.$watch("messages."+t,function(){e.setMessage(t)},!0)})}]}}]),s.directive("pagination",["CONFIG",function(e){return{restrict:"E",scope:{perPage:"@",currentPage:"=",total:"=",fetchPage:"&"},templateUrl:e.partialsUrl+"directive/pagination.twig",controller:["$scope",function(e){e.currentPage=0,e.pageCount=0,e.pages=[],e.calculatePageCount=function(){0===e.total?e.pageCount=1:e.pageCount=Math.ceil(e.total/e.perPage)},e.calculatePages=function(){var t,r,s;for(t=1,r=e.pageCount,e.pages=[],s=t;r>=s;++s)e.pages.push(s)},e.$watch("currentPage",function(){e.calculatePages()}),e.$watch("total",function(){e.calculatePageCount(),e.calculatePages()}),e.prevPage=function(){e.currentPage>0&&--e.currentPage},e.prevPageDisabled=function(){var t=0===e.currentPage?"disabled":"";return t},e.nextPage=function(){e.currentPage<e.pageCount-1&&e.currentPage++},e.nextPageDisabled=function(){var t=e.currentPage===e.pageCount-1?"disabled":"";return t},e.pageDisabled=function(t){var r=e.currentPage===t;return r},e.gotoPage=function(t){e.currentPage=t}}]}}]),s.directive("feedback",["$timeout","feedbackSrv","CONFIG",function(e,t,r){return{restrict:"E",scope:{card:"=",messages:"=",editF:"&",deleteF:"&"},templateUrl:r.partialsUrl+"directive/feedback.twig",controller:["$scope",function(r){r.perPage=5,r.feedback=null,r.total=0,r.currentPage=0,r.timeoutPromise=null,r.getPageOfFeedback=function(s){r.card&&(e.cancel(r.timeoutPromise),t.getPageOfFeedback(s,r.perPage,r.card.id).then(function(e){r.feedback=e.feedback,r.total=e.total},function(e){r.feedback=null,r.total=0,r.messages.error=e.errorMessage})["finally"](function(){r.timeoutPromise=e(function(){r.getPageOfFeedback(r.currentPage)},1e4)}))},r.$watch("currentPage",function(e){r.getPageOfFeedback(e)}),r.$watch("card",function(){r.currentPage=0,r.getPageOfFeedback(r.currentPage)},!0),r.editFeedback=function(e){r.editF({feedback:e})},r.deleteFeedback=function(e){r.deleteF({feedbackid:e})},r.stopAutoRefresh=function(){e.cancel(r.timeoutPromise)},r.startAutoRefresh=function(){r.getPageOfFeedback(r.currentPage)},r.$on("$destroy",function(){e.cancel(r.timeoutPromise)})}]}}]),s.directive("feedbackListItem",["$timeout","CONFIG",function(e,t){return{restrict:"A",scope:{feedback:"=",editFeedback:"&",deleteFeedback:"&",stopAutoRefresh:"&",startAutoRefresh:"&"},templateUrl:t.partialsUrl+"directive/feedbackListItem.twig",controller:["$scope",function(r){r.userid=t.userid,r.editing=!1,r.canFeedback=t.canFeedback,r.enableEditing=function(){r.editing=!0,r.stopAutoRefresh(),r.oldFeedback=r.feedback.feedback,e(function(){r.elem.focus()},1)},r.disableEditing=function(){r.oldFeedback!==r.feedback.feedback?r.editFeedback({feedback:r.feedback}):r.startAutoRefresh()}}],link:function(e,t){e.elem=t.find("input")[0],t.bind("keyup",function(t){!e.editing||13!==t.which&&27!==t.which||e.$apply(function(){e.editing=!1,13===t.which?e.disableEditing():27===t.which&&(e.feedback.feedback=e.oldFeedback,e.startAutoRefresh())})})}}}])},{}],7:[function(e,t,r){"use strict";var s=angular.module("general.filters",[]);s.filter("substring",function(){return function(e,t,r){return e.substring(t,r)}}),s.filter("pipes",["$sce",function(e){return function(t){return t?e.trustAsHtml(t.replace(/\s*,\s*/g,"&nbsp;<strong>|</strong>&nbsp;")):""}}])},{}],8:[function(e,t,r){"use strict";e("./controllers"),e("./directives"),e("./services"),e("./filters")},{"./controllers":5,"./directives":6,"./filters":7,"./services":9}],9:[function(e,t,r){"use strict";var s=angular.module("general.services",[]);s.service("wordsSrv",["$http","$q","CONFIG",function(e,t,r){var s=r.apiUrls.words;this.getPageOfWords=function(r,n,o,i){var c=t.defer();return e.get(s+"?limitfrom="+r*n+"&limitnum="+n+"&sectionid="+o+"&q="+encodeURIComponent(i)).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.getWord=function(r){var n=t.defer();return e.get(s+"/"+r).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.postWord=function(n,o){var i=t.defer(),c={word:n,sectionid:o};return e.post(s+"?sesskey="+r.sesskey,c).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.putWord=function(n,o,i){var c=t.defer(),a={word:o,sectionid:i};return e.put(s+"/"+n+"?sesskey="+r.sesskey,a).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.deleteWord=function(n){var o=t.defer();return e["delete"](s+"/"+n+"?sesskey="+r.sesskey).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}]),s.service("studentsSrv",["$http","$q","CONFIG",function(e,t,r){var s=r.apiUrls.students;this.getPageOfStudents=function(r,n,o){var i=t.defer();return e.get(s+"?limitfrom="+r*n+"&limitnum="+n+"&groupid="+o).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}]),s.service("cardsSrv",["$http","$q","CONFIG",function(e,t,r){var s=r.apiUrls.cards;this.getPageOfStudentCardsInActivity=function(r,n,o){var i=t.defer();return e.get(s+"?limitfrom="+r*n+"&limitnum="+n+"&instanceid="+o).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.getPageOfCardsInReviewInActivity=function(r,n,o){var i=t.defer();return e.get(s+"/review?limitfrom="+r*n+"&limitnum="+n+"&instanceid="+o).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.getPageOfCardsInRepositoryInCourse=function(r,n,o){var i=t.defer();return e.get(s+"/repository?limitfrom="+r*n+"&limitnum="+n+"&groupid="+o.groupid+"&userid="+o.userid+"&q="+encodeURIComponent(o.q)+"&status="+o.status+"&sort="+encodeURIComponent(o.sort)).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.getCard=function(r){var n=t.defer();return e.get(s+"/"+r).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.putCard=function(n,o){var i=t.defer();return e.put(s+"/"+n+"?sesskey="+r.sesskey,o).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.createCardsFromWords=function(n,o,i){var c=t.defer(),a=[],u={};return angular.forEach(n,function(e){a.push(e.id)}),u.wordids=a,u.ownerid=o.id,u.groupid=i,e.post(s+"/create?sesskey="+r.sesskey,u).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.deleteCard=function(n){var o=t.defer();return e["delete"](s+"/"+n+"?sesskey="+r.sesskey).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},this.displayWord=function(e){return e?e.word.charAt(0).toUpperCase()+e.word.slice(1):""}}]),s.service("feedbackSrv",["$http","$q","CONFIG",function(e,t,r){var s=r.apiUrls.feedbacks;this.getPageOfFeedback=function(r,n,o){var i=t.defer();return e.get(s+"?limitfrom="+r*n+"&limitnum="+n+"&cardid="+o).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.postFeedback=function(n,o){var i=t.defer(),c={feedback:n,cardid:o},a=r.hasOwnProperty("cmid")?"&cmid="+r.cmid:"";return e.post(s+"?sesskey="+r.sesskey+"&app="+r.app+a,c).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.putFeedback=function(n){var o=t.defer(),i={feedback:n.feedback};return e.put(s+"/"+n.id+"?sesskey="+r.sesskey+"&app="+r.app,i).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},this.deleteFeedback=function(n){var o=t.defer();return e["delete"](s+"/"+n+"?sesskey="+r.sesskey+"&app="+r.app).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}]),s.service("repoFilterSrv",["CONFIG",function(e){this.filters={groupid:0,userid:0,q:"",status:e.reverseCardStatus.in_repository,sort:"word"}}]),s.service("initialRouteSrv",["$location","CONFIG",function(e,t){var r=[];t.angularjs_route&&r.push(t.angularjs_route),this.checkStack=function(){var t=null;return r.length&&(t=r.pop(),e.path(t)),t}}]),s.service("messageSrv",function(){this.messages={},this.collect=function(){var e={};return angular.copy(this.messages,e),this.messages={},e}})},{}]},{},[2]);